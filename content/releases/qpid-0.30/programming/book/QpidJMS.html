<!DOCTYPE html>
<!--
 -
 - Licensed to the Apache Software Foundation (ASF) under one
 - or more contributor license agreements.  See the NOTICE file
 - distributed with this work for additional information
 - regarding copyright ownership.  The ASF licenses this file
 - to you under the Apache License, Version 2.0 (the
 - "License"); you may not use this file except in compliance
 - with the License.  You may obtain a copy of the License at
 -
 -   http://www.apache.org/licenses/LICENSE-2.0
 -
 - Unless required by applicable law or agreed to in writing,
 - software distributed under the License is distributed on an
 - "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 - KIND, either express or implied.  See the License for the
 - specific language governing permissions and limitations
 - under the License.
 -
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
  <head>
    <title>Chapter&#160;3.&#160;Using the Qpid JMS client - Apache Qpid&#8482;</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link rel="stylesheet" href="/site.css" type="text/css" async="async"/>
    <link rel="stylesheet" href="/deferred.css" type="text/css" defer="defer"/>
    <script type="text/javascript">var _deferredFunctions = [];</script>
    <script type="text/javascript" src="/deferred.js" defer="defer"></script>
    <!--[if lte IE 8]>
      <link rel="stylesheet" href="/ie.css" type="text/css"/>
      <script type="text/javascript" src="/html5shiv.js"></script>
    <![endif]-->

    <!-- Redirects for `go get` and godoc.org -->
    <meta name="go-import"
          content="qpid.apache.org git https://git-wip-us.apache.org/repos/asf/qpid-proton.git"/>
    <meta name="go-source"
          content="qpid.apache.org
https://github.com/apache/qpid-proton/blob/go1/README.md
https://github.com/apache/qpid-proton/tree/go1{/dir}
https://github.com/apache/qpid-proton/blob/go1{/dir}/{file}#L{line}"/>
  </head>
  <body>
    <div id="-content">
      <div id="-top" class="panel">
        <a id="-menu-link"><img width="16" height="16" src="" alt="Menu"/></a>

        <a id="-search-link"><img width="22" height="16" src="" alt="Search"/></a>

        <ul id="-global-navigation">
          <li><a id="-logotype" href="/index.html">Apache Qpid<sup>&#8482;</sup></a></li>
          <li><a href="/documentation.html">Documentation</a></li>
          <li><a href="/download.html">Download</a></li>
          <li><a href="/discussion.html">Discussion</a></li>
        </ul>
      </div>

      <div id="-menu" class="panel" style="display: none;">
        <div class="flex">
          <section>
            <h3>Project</h3>

            <ul>
              <li><a href="/overview.html">Overview</a></li>
              <li><a href="/components/index.html">Components</a></li>
              <li><a href="/releases/index.html">Releases</a></li>
            </ul>
          </section>

          <section>
            <h3>Messaging APIs</h3>

            <ul>
              <li><a href="/proton/index.html">Qpid Proton</a></li>
              <li><a href="/components/jms/index.html">Qpid JMS</a></li>
              <li><a href="/components/messaging-api/index.html">Qpid Messaging API</a></li>
            </ul>
          </section>

          <section>
            <h3>Servers and tools</h3>

            <ul>
              <li><a href="/components/java-broker/index.html">Java broker</a></li>
              <li><a href="/components/cpp-broker/index.html">C++ broker</a></li>
              <li><a href="/components/dispatch-router/index.html">Dispatch router</a></li>
            </ul>
          </section>

          <section>
            <h3>Resources</h3>

            <ul>
              <li><a href="/dashboard.html">Dashboard</a></li>
              <li><a href="https://cwiki.apache.org/confluence/display/qpid/Index">Wiki</a></li>
              <li><a href="/resources.html">More resources</a></li>
            </ul>
          </section>
        </div>
      </div>

      <div id="-search" class="panel" style="display: none;">
        <form action="http://www.google.com/search" method="get">
          <input type="hidden" name="sitesearch" value="qpid.apache.org"/>
          <input type="text" name="q" maxlength="255" autofocus="autofocus" tabindex="1"/>
          <button type="submit">Search</button>
          <a href="/search.html">More ways to search</a>
        </form>
      </div>

      <div id="-middle" class="panel">
        <ul id="-path-navigation"><li><a href="/index.html">Home</a></li><li><a href="/releases/index.html">Releases</a></li><li><a href="/releases/qpid-0.30/index.html">Qpid 0.30</a></li><li><a href="/releases/qpid-0.30/programming/book/index.html">Programming in Apache Qpid</a></li><li>Chapter&#160;3.&#160;Using the Qpid JMS client</li></ul>

        <div id="-middle-content">
          <div class="docbook"><div class="navheader"><table summary="Navigation header" width="100%"><tr><th align="center" colspan="3">Chapter&#160;3.&#160;Using the Qpid JMS client</th></tr><tr><td align="left" width="20%"><a accesskey="p" href="Message-Groups-Guide.html">Prev</a>&#160;</td><th align="center" width="60%">&#160;</th><td align="right" width="20%">&#160;<a accesskey="n" href="QpidJNDI.html">Next</a></td></tr></table><hr /></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="QpidJMS"></a>Chapter&#160;3.&#160;Using the Qpid JMS client</h1></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl class="toc"><dt><span class="section"><a href="QpidJMS.html#idm139972650204288">3.1. A Simple Messaging Program in Java JMS</a></span></dt><dt><span class="section"><a href="QpidJNDI.html">3.2. Apache Qpid JNDI Properties for AMQP Messaging</a></span></dt><dd><dl><dt><span class="section"><a href="QpidJNDI.html#idm139972650161680">3.2.1. JNDI Properties for Apache Qpid</a></span></dt><dt><span class="section"><a href="QpidJNDI.html#section-jms-connection-url">3.2.2. Connection URLs</a></span></dt></dl></dd><dt><span class="section"><a href="ch03s03.html">3.3. Java JMS Message Properties</a></span></dt><dt><span class="section"><a href="section-JMS-MapMessage.html">3.4. JMS MapMessage Types</a></span></dt><dt><span class="section"><a href="section-JMS-Logging.html">3.5. JMS Client Logging</a></span></dt><dt><span class="section"><a href="ch03s06.html">3.6. Configuring the JMS Client</a></span></dt><dd><dl><dt><span class="section"><a href="ch03s06.html#client-jvm-properties">3.6.1. Qpid JVM Arguments</a></span></dt></dl></dd></dl></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139972650204288"></a>3.1.&#160;A Simple Messaging Program in Java JMS</h2></div></div></div><p>The following program shows how to send and receive a
      message using the Qpid JMS client. JMS programs typically use
      JNDI to obtain connection factory and destination objects which
      the application needs. In this way the configuration is kept
      separate from the application code itself.</p><p>In this example, we create a JNDI context using a
      properties file, use the context to lookup a connection factory,
      create and start a connection, create a session, and lookup a
      destination from the JNDI context. Then we create a producer and
      a consumer, send a message with the producer and receive it with
      the consumer. This code should be straightforward for anyone
      familiar with Java JMS.</p><div class="example"><a id="idm139972650202112"></a><p class="title"><strong>Example&#160;3.1.&#160;"Hello world!" in Java</strong></p><div class="example-contents"><pre class="programlisting" lang="java" xml:lang="java">
	  package org.apache.qpid.example.jmsexample.hello;

	  import javax.jms.*;
	  import javax.naming.Context;
	  import javax.naming.InitialContext;
	  import java.util.Properties;

	  public class Hello {

	  public Hello() {
	  }

	  public static void main(String[] args) {
	  Hello producer = new Hello();
	  producer.runTest();
	  }

	  private void runTest() {
	  try {
	  Properties properties = new Properties();
	  properties.load(this.getClass().getResourceAsStream("hello.properties"));  <a class="co" href="QpidJMS.html#callout-java-properties" id="hello-java-properties">(1)</a>
	  Context context = new InitialContext(properties);   <a class="co" href="QpidJMS.html#callout-java-context" id="hello-java-context">(2)</a>

	  ConnectionFactory connectionFactory
          = (ConnectionFactory) context.lookup("qpidConnectionfactory"); <a class="co" href="QpidJMS.html#callout-java-connection-factory" id="hello-java-connection-factory">(3)</a>
	  Connection connection = connectionFactory.createConnection();  <a class="co" href="QpidJMS.html#callout-java-connection" id="hello-java-connection">(4)</a>
	  connection.start();  <a class="co" href="QpidJMS.html#callout-java-start" id="hello-java-start">(5)</a>

	  Session session=connection.createSession(false,Session.AUTO_ACKNOWLEDGE);<a class="co" href="QpidJMS.html#callout-java-session" id="hello-java-session">(6)</a>
	  Destination destination = (Destination) context.lookup("topicExchange");  <a class="co" href="QpidJMS.html#callout-java-destination" id="hello-java-destination">(7)</a>

	  MessageProducer messageProducer = session.createProducer(destination);  <a class="co" href="QpidJMS.html#callout-java-producer" id="hello-java-producer">(8)</a>
	  MessageConsumer messageConsumer = session.createConsumer(destination);  <a class="co" href="QpidJMS.html#callout-java-consumer" id="hello-java-consumer">(9)</a>

	  TextMessage message = session.createTextMessage("Hello world!");
	  messageProducer.send(message);

	  message = (TextMessage)messageConsumer.receive();    <a class="co" href="QpidJMS.html#callout-java-receive" id="hello-java-receive">(10)</a>
	  System.out.println(message.getText());

	  connection.close();  <a class="co" href="QpidJMS.html#callout-java-close" id="hello-java-close">(11)</a>
	  context.close();   <a class="co" href="QpidJMS.html#callout-java-jndi-close" id="hello-java-jndi-close">(12)</a>
	  }
	  catch (Exception exp) {
	  exp.printStackTrace();
	  }
	  }
	  }
	</pre></div></div><br class="example-break" /><div class="calloutlist"><table border="0" summary="Callout list"><tr><td align="left" valign="top" width="5%"><p><a id="callout-java-properties"></a><a href="#hello-java-properties">(1)</a> </p></td><td align="left" valign="top"><p>Loads the JNDI properties file, which specifies connection properties, queues, topics, and addressing options. See <a class="xref" href="QpidJNDI.html" title="3.2.&#160;Apache Qpid JNDI Properties for AMQP Messaging">Section&#160;3.2, &#8220;Apache Qpid JNDI Properties for AMQP Messaging&#8221;</a> for details.</p></td></tr><tr><td align="left" valign="top" width="5%"><p><a id="callout-java-context"></a><a href="#hello-java-context">(2)</a> </p></td><td align="left" valign="top"><p>Creates the JNDI initial context.</p></td></tr><tr><td align="left" valign="top" width="5%"><p><a id="callout-java-connection-factory"></a><a href="#hello-java-connection-factory">(3)</a> </p></td><td align="left" valign="top"><p>Creates a JMS connection factory for Qpid.</p></td></tr><tr><td align="left" valign="top" width="5%"><p><a id="callout-java-connection"></a><a href="#hello-java-connection">(4)</a> </p></td><td align="left" valign="top"><p>Creates a JMS connection.</p></td></tr><tr><td align="left" valign="top" width="5%"><p><a id="callout-java-start"></a><a href="#hello-java-start">(5)</a> </p></td><td align="left" valign="top"><p>Activates the connection.</p></td></tr><tr><td align="left" valign="top" width="5%"><p><a id="callout-java-session"></a><a href="#hello-java-session">(6)</a> </p></td><td align="left" valign="top"><p>Creates a session. This session is not transactional (transactions='false'), and messages are automatically acknowledged.</p></td></tr><tr><td align="left" valign="top" width="5%"><p><a id="callout-java-destination"></a><a href="#hello-java-destination">(7)</a> </p></td><td align="left" valign="top"><p>Creates a destination for the topic exchange, so senders and receivers can use it.</p></td></tr><tr><td align="left" valign="top" width="5%"><p><a id="callout-java-producer"></a><a href="#hello-java-producer">(8)</a> </p></td><td align="left" valign="top"><p>Creates a producer that sends messages to the topic exchange.</p></td></tr><tr><td align="left" valign="top" width="5%"><p><a id="callout-java-consumer"></a><a href="#hello-java-consumer">(9)</a> </p></td><td align="left" valign="top"><p>Creates a consumer that reads messages from the topic exchange.</p></td></tr><tr><td align="left" valign="top" width="5%"><p><a id="callout-java-receive"></a><a href="#hello-java-receive">(10)</a> </p></td><td align="left" valign="top"><p>Reads the next available message.</p></td></tr><tr><td align="left" valign="top" width="5%"><p><a id="callout-java-close"></a><a href="#hello-java-close">(11)</a> </p></td><td align="left" valign="top"><p>Closes the connection, all sessions managed by the connection, and all senders and receivers managed by each session.</p></td></tr><tr><td align="left" valign="top" width="5%"><p><a id="callout-java-jndi-close"></a><a href="#hello-java-jndi-close">(12)</a> </p></td><td align="left" valign="top"><p>Closes the JNDI context.</p></td></tr></table></div><p>The contents of the hello.properties file are shown below.</p><div class="example"><a id="idm139972650173136"></a><p class="title"><strong>Example&#160;3.2.&#160;JNDI Properties File for "Hello world!" example</strong></p><div class="example-contents"><pre class="programlisting">
	  java.naming.factory.initial
	  = org.apache.qpid.jndi.PropertiesFileInitialContextFactory

	  # connectionfactory.[jndiname] = [ConnectionURL]
	  connectionfactory.qpidConnectionfactory
	  = amqp://guest:guest@clientid/test?brokerlist='tcp://localhost:5672' <a class="co" href="QpidJMS.html#callout-hello-properties-connectionfactory" id="hello-properties-connectionfactory">(1)</a>
	  # destination.[jndiname] = [address_string]
	  destination.topicExchange = amq.topic <a class="co" href="QpidJMS.html#callout-hello-properties-destination" id="hello-properties-destination">(2)</a>
	</pre></div></div><br class="example-break" /><div class="calloutlist"><table border="0" summary="Callout list"><tr><td align="left" valign="top" width="5%"><p><a id="callout-hello-properties-connectionfactory"></a><a href="#hello-properties-connectionfactory">(1)</a> </p></td><td align="left" valign="top"><p>Defines a connection factory from which connections
	  can be created. The syntax of a ConnectionURL is given in
	  <a class="xref" href="QpidJNDI.html" title="3.2.&#160;Apache Qpid JNDI Properties for AMQP Messaging">Section&#160;3.2, &#8220;Apache Qpid JNDI Properties for AMQP Messaging&#8221;</a>.</p></td></tr><tr><td align="left" valign="top" width="5%"><p><a id="callout-hello-properties-destination"></a><a href="#hello-properties-destination">(2)</a> </p></td><td align="left" valign="top"><p>Defines a destination for which MessageProducers
	  and/or MessageConsumers can be created to send and receive
	  messages. The value for the destination in the properties
	  file is an address string as described in
	  <a class="xref" href="section-addresses.html" title="2.4.&#160;Addresses">Section&#160;2.4, &#8220;Addresses&#8221;</a>. In the JMS
	  implementation MessageProducers are analogous to senders in
	  the Qpid Message API, and MessageConsumers are analogous to
	  receivers.</p></td></tr></table></div></div></div><div class="navfooter"><hr /><table summary="Navigation footer" width="100%"><tr><td align="left" width="40%"><a accesskey="p" href="Message-Groups-Guide.html">Prev</a>&#160;</td><td align="center" width="20%">&#160;</td><td align="right" width="40%">&#160;<a accesskey="n" href="QpidJNDI.html">Next</a></td></tr><tr><td align="left" valign="top" width="40%">2.17.&#160;Using Message Groups&#160;</td><td align="center" width="20%"><a accesskey="h" href="index.html">Home</a></td><td align="right" valign="top" width="40%">&#160;3.2.&#160;Apache Qpid JNDI Properties for AMQP Messaging</td></tr></table></div></div>

          <hr/>

          <ul id="-apache-navigation">
            <li><a href="http://www.apache.org/">Apache</a></li>
            <li><a href="http://www.apache.org/licenses/">License</a></li>
            <li><a href="http://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
            <li><a href="http://www.apache.org/foundation/thanks.html">Thanks!</a></li>
            <li><a href="/security.html">Security</a></li>
            <li><a href="http://www.apache.org/"><img id="-apache-feather" width="48" height="14" src="" alt="Apache"/></a></li>
          </ul>

          <p id="-legal">
            Apache Qpid, Messaging built on AMQP; Copyright &#169; 2015
            The Apache Software Foundation; Licensed under
            the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache
            License, Version 2.0</a>; Apache Qpid, Qpid, Qpid Proton,
            Proton, Apache, the Apache feather logo, and the Apache Qpid
            project logo are trademarks of The Apache Software
            Foundation; All other marks mentioned may be trademarks or
            registered trademarks of their respective owners
          </p>
        </div>
      </div>
    </div>
  </body>
</html>
