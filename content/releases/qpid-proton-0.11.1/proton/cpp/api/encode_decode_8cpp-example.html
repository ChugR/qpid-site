<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>C++ AMQP Protocol Engine API: encode_decode.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">C++ AMQP Protocol Engine API
   &#160;<span id="projectnumber">0.11.1</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('encode_decode_8cpp-example.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">encode_decode.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<p>Shows how C++ data types can be converted to and from AMQP types.</p>
<div class="fragment"><div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Licensed to the Apache Software Foundation (ASF) under one</span></div>
<div class="line"><span class="comment"> * or more contributor license agreements.  See the NOTICE file</span></div>
<div class="line"><span class="comment"> * distributed with this work for additional information</span></div>
<div class="line"><span class="comment"> * regarding copyright ownership.  The ASF licenses this file</span></div>
<div class="line"><span class="comment"> * to you under the Apache License, Version 2.0 (the</span></div>
<div class="line"><span class="comment"> * &quot;License&quot;); you may not use this file except in compliance</span></div>
<div class="line"><span class="comment"> * with the License.  You may obtain a copy of the License at</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *   http://www.apache.org/licenses/LICENSE-2.0</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Unless required by applicable law or agreed to in writing,</span></div>
<div class="line"><span class="comment"> * software distributed under the License is distributed on an</span></div>
<div class="line"><span class="comment"> * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span></div>
<div class="line"><span class="comment"> * KIND, either express or implied.  See the License for the</span></div>
<div class="line"><span class="comment"> * specific language governing permissions and limitations</span></div>
<div class="line"><span class="comment"> * under the License.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="value_8hpp.html">proton/value.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iterator&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;map&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sstream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">using namespace </span>std;</div>
<div class="line"></div>
<div class="line"><span class="comment">// Examples of how to use the encoder and decoder to create and examine AMQP values.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// Print is defined at the end as an example of how to query and extract complex</span></div>
<div class="line"><span class="comment">// values in terms of their simple components.</span></div>
<div class="line"><span class="keywordtype">void</span> print(<a name="_a0"></a><a class="code" href="classproton_1_1data.html">proton::data</a>&amp;);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Inserting and extracting simple C++ values.</span></div>
<div class="line"><span class="keywordtype">void</span> simple_insert_extract() {</div>
<div class="line">    cout &lt;&lt; endl &lt;&lt; <span class="stringliteral">&quot;== Simple values: int, string, bool&quot;</span> &lt;&lt; endl;</div>
<div class="line">    <a name="_a1"></a><a class="code" href="classproton_1_1value.html">proton::value</a> dv;</div>
<div class="line">    dv.<a name="a2"></a><a class="code" href="classproton_1_1value.html#a4add8b347e6b044857f2cffe9b0a9165">encoder</a>() &lt;&lt; 42 &lt;&lt; <span class="stringliteral">&quot;foo&quot;</span> &lt;&lt; <span class="keyword">true</span>;</div>
<div class="line">    print(dv);</div>
<div class="line">    <span class="keywordtype">int</span> i;</div>
<div class="line">    <span class="keywordtype">string</span> s;</div>
<div class="line">    <span class="keywordtype">bool</span> b;</div>
<div class="line">    dv.<a name="a3"></a><a class="code" href="classproton_1_1value.html#af2c744fb715eb0778a412d023f3ec470">decoder</a>().<a name="a4"></a><a class="code" href="classproton_1_1decoder.html#ae8566d9b29e7bdad7d327c6993a02c1c">rewind</a>();</div>
<div class="line">    dv.<a class="code" href="classproton_1_1value.html#af2c744fb715eb0778a412d023f3ec470">decoder</a>() &gt;&gt; i &gt;&gt; s &gt;&gt; b;</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;Extracted: &quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; s &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; b &lt;&lt; endl;</div>
<div class="line">    <span class="comment">// Encode and decode as AMQP</span></div>
<div class="line">    <span class="keywordtype">string</span> amqp_data = dv.<a class="code" href="classproton_1_1value.html#a4add8b347e6b044857f2cffe9b0a9165">encoder</a>().<a name="a5"></a><a class="code" href="classproton_1_1encoder.html#a082ae9415244cf2eec0c538688d727c3">encode</a>();</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;Encoded as AMQP in &quot;</span> &lt;&lt; amqp_data.size() &lt;&lt; <span class="stringliteral">&quot; bytes&quot;</span> &lt;&lt; endl;</div>
<div class="line">    <a class="code" href="classproton_1_1value.html">proton::value</a>  dt2;</div>
<div class="line">    dt2.<a class="code" href="classproton_1_1value.html#af2c744fb715eb0778a412d023f3ec470">decoder</a>().<a name="a6"></a><a class="code" href="classproton_1_1decoder.html#a560f905d457ea6f15f1bbe2cd7737d04">decode</a>(amqp_data);</div>
<div class="line">    dt2.<a class="code" href="classproton_1_1value.html#af2c744fb715eb0778a412d023f3ec470">decoder</a>() &gt;&gt; i &gt;&gt; s &gt;&gt; b;</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;Decoded: &quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; s &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; b &lt;&lt; endl;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Inserting values as a specific AMQP type</span></div>
<div class="line"><span class="keywordtype">void</span> simple_insert_extract_exact_type() {</div>
<div class="line">    <a class="code" href="classproton_1_1value.html">proton::value</a> dv;</div>
<div class="line">    cout &lt;&lt; endl &lt;&lt; <span class="stringliteral">&quot;== Specific AMQP types: byte, long, symbol&quot;</span> &lt;&lt; endl;</div>
<div class="line">    dv.<a class="code" href="classproton_1_1value.html#a4add8b347e6b044857f2cffe9b0a9165">encoder</a>() &lt;&lt; <a name="a7"></a><a class="code" href="namespaceproton.html#a266b8262a287813a7698574e9835a862">proton::amqp_byte</a>(<span class="charliteral">&#39;x&#39;</span>) &lt;&lt; <a name="a8"></a><a class="code" href="namespaceproton.html#aba077a8f29c4dcf16a01bc8ef38fbb9c">proton::amqp_long</a>(123456789123456789) &lt;&lt; <a name="_a9"></a><a class="code" href="structproton_1_1amqp__symbol.html">proton::amqp_symbol</a>(<span class="stringliteral">&quot;bar&quot;</span>);</div>
<div class="line">    print(dv);</div>
<div class="line">    dv.<a class="code" href="classproton_1_1value.html#af2c744fb715eb0778a412d023f3ec470">decoder</a>().<a class="code" href="classproton_1_1decoder.html#ae8566d9b29e7bdad7d327c6993a02c1c">rewind</a>();</div>
<div class="line">    <span class="comment">// Check that we encoded the correct types, but note that decoding will</span></div>
<div class="line">    <span class="comment">// still convert to standard C++ types, in particular any AMQP integer type</span></div>
<div class="line">    <span class="comment">// can be converted to a long-enough C++ integer type..</span></div>
<div class="line">    int64_t i1, i2;</div>
<div class="line">    <span class="keywordtype">string</span> s;</div>
<div class="line">    dv.<a class="code" href="classproton_1_1value.html#af2c744fb715eb0778a412d023f3ec470">decoder</a>() &gt;&gt; i1 &gt;&gt; i2 &gt;&gt; s;</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;Extracted (with conversion) &quot;</span> &lt;&lt; i1 &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; i2 &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; s &lt;&lt; endl;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Now use the as() function to fail unless we extract the exact AMQP type expected.</span></div>
<div class="line">    dv.<a class="code" href="classproton_1_1value.html#af2c744fb715eb0778a412d023f3ec470">decoder</a>().<a class="code" href="classproton_1_1decoder.html#ae8566d9b29e7bdad7d327c6993a02c1c">rewind</a>(); <span class="comment">// amqp_byte(1) &lt;&lt; amqp_long(2) &lt;&lt; amqp_symbol(&quot;bar&quot;);</span></div>
<div class="line">    <a class="code" href="namespaceproton.html#aba077a8f29c4dcf16a01bc8ef38fbb9c">proton::amqp_long</a> l;</div>
<div class="line">    <span class="comment">// Fails, extracting amqp_byte as amqp_long</span></div>
<div class="line">    <span class="keywordflow">try</span> { dv.<a class="code" href="classproton_1_1value.html#af2c744fb715eb0778a412d023f3ec470">decoder</a>() &gt;&gt; proton::as&lt;proton::LONG&gt;(l); <span class="keywordflow">throw</span> logic_error(<span class="stringliteral">&quot;expected error&quot;</span>); } <span class="keywordflow">catch</span> (<a name="_a10"></a><a class="code" href="structproton_1_1decode__error.html">proton::decode_error</a>) {}</div>
<div class="line">    <a class="code" href="namespaceproton.html#a266b8262a287813a7698574e9835a862">proton::amqp_byte</a> b;</div>
<div class="line">    dv.<a class="code" href="classproton_1_1value.html#af2c744fb715eb0778a412d023f3ec470">decoder</a>() &gt;&gt; proton::as&lt;proton::BYTE&gt;(b) &gt;&gt; proton::as&lt;proton::LONG&gt;(l); <span class="comment">// OK, extract amqp_byte as amqp_byte, amqp_long as amqp_long.</span></div>
<div class="line">    <span class="keywordtype">string</span> <a name="a11"></a><a class="code" href="namespaceproton.html#a64e152a44f8fa1038b0093dbb570de29">str</a>;</div>
<div class="line">    <span class="comment">// Fails, extracting amqp_symbol as amqp_string.</span></div>
<div class="line">    <span class="keywordflow">try</span> { dv.<a class="code" href="classproton_1_1value.html#af2c744fb715eb0778a412d023f3ec470">decoder</a>() &gt;&gt; proton::as&lt;proton::STRING&gt;(<a class="code" href="namespaceproton.html#a64e152a44f8fa1038b0093dbb570de29">str</a>); <span class="keywordflow">throw</span> logic_error(<span class="stringliteral">&quot;expected error&quot;</span>); } <span class="keywordflow">catch</span> (<a class="code" href="structproton_1_1decode__error.html">proton::decode_error</a>) {}</div>
<div class="line">    dv.<a class="code" href="classproton_1_1value.html#af2c744fb715eb0778a412d023f3ec470">decoder</a>() &gt;&gt; proton::as&lt;proton::SYMBOL&gt;(<a class="code" href="namespaceproton.html#a64e152a44f8fa1038b0093dbb570de29">str</a>);       <span class="comment">// OK, extract amqp_symbol as amqp_symbol</span></div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;Extracted (exact) &quot;</span> &lt;&lt; b &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; l &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; str &lt;&lt; endl;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Some helper templates to print map and vector results.</span></div>
<div class="line"><span class="keyword">namespace </span>std {</div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T, <span class="keyword">class</span> U&gt; ostream&amp; operator&lt;&lt;(ostream&amp; o, const pair&lt;T,U&gt;&amp; p) {</div>
<div class="line">    <span class="keywordflow">return</span> o &lt;&lt; p.first &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; p.second;</div>
<div class="line">}</div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt; ostream&amp; operator&lt;&lt;(ostream&amp; o, const vector&lt;T&gt;&amp; v) {</div>
<div class="line">    o &lt;&lt; <span class="stringliteral">&quot;[ &quot;</span>;</div>
<div class="line">    ostream_iterator&lt;T&gt; oi(o, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line">    copy(v.begin(), v.end(), oi);</div>
<div class="line">    <span class="keywordflow">return</span> o &lt;&lt; <span class="stringliteral">&quot;]&quot;</span>;</div>
<div class="line">}</div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> K, <span class="keyword">class</span> T&gt; ostream&amp; operator&lt;&lt;(ostream&amp; o, const map&lt;K, T&gt;&amp; m) {</div>
<div class="line">    o &lt;&lt; <span class="stringliteral">&quot;{ &quot;</span>;</div>
<div class="line">    ostream_iterator&lt;pair&lt;K,T&gt; &gt; oi(o, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line">    copy(m.begin(), m.end(), oi);</div>
<div class="line">    <span class="keywordflow">return</span> o &lt;&lt; <span class="stringliteral">&quot;}&quot;</span>;</div>
<div class="line">}</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Insert/extract C++ containers.</span></div>
<div class="line"><span class="keywordtype">void</span> insert_extract_containers() {</div>
<div class="line">    cout &lt;&lt; endl &lt;&lt; <span class="stringliteral">&quot;== Array, list and map.&quot;</span> &lt;&lt; endl;</div>
<div class="line"></div>
<div class="line">    vector&lt;int&gt; a;</div>
<div class="line">    a.push_back(1);</div>
<div class="line">    a.push_back(2);</div>
<div class="line">    a.push_back(3);</div>
<div class="line">    vector&lt;int&gt; l;</div>
<div class="line">    l.push_back(4);</div>
<div class="line">    l.push_back(5);</div>
<div class="line">    map&lt;string, int&gt; m;</div>
<div class="line">    m[<span class="stringliteral">&quot;one&quot;</span>] = 1;</div>
<div class="line">    m[<span class="stringliteral">&quot;two&quot;</span>] = 2;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="classproton_1_1value.html">proton::value</a> dv;</div>
<div class="line">    dv.<a class="code" href="classproton_1_1value.html#a4add8b347e6b044857f2cffe9b0a9165">encoder</a>() &lt;&lt; proton::as&lt;proton::ARRAY&gt;(a) &lt;&lt; proton::as&lt;proton::LIST&gt;(l) &lt;&lt; proton::as&lt;proton::MAP&gt;(m);</div>
<div class="line">    print(dv);</div>
<div class="line"></div>
<div class="line">    vector&lt;int&gt; a1, l1;</div>
<div class="line">    map&lt;string, int&gt; m1;</div>
<div class="line">    dv.<a class="code" href="classproton_1_1value.html#af2c744fb715eb0778a412d023f3ec470">decoder</a>().<a class="code" href="classproton_1_1decoder.html#ae8566d9b29e7bdad7d327c6993a02c1c">rewind</a>();</div>
<div class="line">    dv.<a class="code" href="classproton_1_1value.html#af2c744fb715eb0778a412d023f3ec470">decoder</a>() &gt;&gt; proton::as&lt;proton::ARRAY&gt;(a1) &gt;&gt; proton::as&lt;proton::LIST&gt;(l1) &gt;&gt; proton::as&lt;proton::MAP&gt;(m1);</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;Extracted: &quot;</span> &lt;&lt; a1 &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; l1 &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; m1 &lt;&lt; endl;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Containers with mixed types, use value to represent arbitrary AMQP types.</span></div>
<div class="line"><span class="keywordtype">void</span> mixed_containers() {</div>
<div class="line">    cout &lt;&lt; endl &lt;&lt; <span class="stringliteral">&quot;== List and map of mixed type values.&quot;</span> &lt;&lt; endl;</div>
<div class="line">    vector&lt;proton::value&gt; l;</div>
<div class="line">    l.push_back(<a class="code" href="classproton_1_1value.html">proton::value</a>(42));</div>
<div class="line">    l.push_back(<a class="code" href="classproton_1_1value.html">proton::value</a>(<a name="_a12"></a><a class="code" href="structproton_1_1amqp__string.html">proton::amqp_string</a>(<span class="stringliteral">&quot;foo&quot;</span>)));</div>
<div class="line">    map&lt;proton::value, proton::value&gt; m;</div>
<div class="line">    m[<a class="code" href="classproton_1_1value.html">proton::value</a>(<span class="stringliteral">&quot;five&quot;</span>)] = <a class="code" href="classproton_1_1value.html">proton::value</a>(5);</div>
<div class="line">    m[<a class="code" href="classproton_1_1value.html">proton::value</a>(4)] = <a class="code" href="classproton_1_1value.html">proton::value</a>(<span class="stringliteral">&quot;four&quot;</span>);</div>
<div class="line">    <a class="code" href="classproton_1_1value.html">proton::value</a> dv;</div>
<div class="line">    dv.<a class="code" href="classproton_1_1value.html#a4add8b347e6b044857f2cffe9b0a9165">encoder</a>() &lt;&lt; proton::as&lt;proton::LIST&gt;(l) &lt;&lt; proton::as&lt;proton::MAP&gt;(m);</div>
<div class="line">    print(dv);</div>
<div class="line"></div>
<div class="line">    vector&lt;proton::value&gt; l1;</div>
<div class="line">    map&lt;proton::value, proton::value&gt; m1;</div>
<div class="line">    dv.<a class="code" href="classproton_1_1value.html#af2c744fb715eb0778a412d023f3ec470">decoder</a>().<a class="code" href="classproton_1_1decoder.html#ae8566d9b29e7bdad7d327c6993a02c1c">rewind</a>();</div>
<div class="line">    dv.<a class="code" href="classproton_1_1value.html#af2c744fb715eb0778a412d023f3ec470">decoder</a>() &gt;&gt; proton::as&lt;proton::LIST&gt;(l1) &gt;&gt; proton::as&lt;proton::MAP&gt;(m1);</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;Extracted: &quot;</span> &lt;&lt; l1 &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; m1 &lt;&lt; endl;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Insert using stream operators (see print_next for example of extracting with stream ops.)</span></div>
<div class="line"><span class="keywordtype">void</span> insert_extract_stream_operators() {</div>
<div class="line">    cout &lt;&lt; endl &lt;&lt; <span class="stringliteral">&quot;== Insert with stream operators.&quot;</span> &lt;&lt; endl;</div>
<div class="line">    <a class="code" href="classproton_1_1value.html">proton::value</a> dv;</div>
<div class="line">    <span class="comment">// Note: array elements must be encoded with the exact type, they are not</span></div>
<div class="line">    <span class="comment">// automaticlly converted. Mismatched types for array elements will not</span></div>
<div class="line">    <span class="comment">// be detected until dv.encode() is called.</span></div>
<div class="line">    dv.<a class="code" href="classproton_1_1value.html#a4add8b347e6b044857f2cffe9b0a9165">encoder</a>() &lt;&lt; <a name="a13"></a><a class="code" href="structproton_1_1start.html#ada681ee661f7fed74502089d0c07e752">proton::start::array</a>(<a name="a14"></a><a class="code" href="namespaceproton.html#a4b010ef0671b257e9ef88d3c903572bca11d75016988ba1ccf672e3c6fc46c932">proton::INT</a>) &lt;&lt; <a name="a15"></a><a class="code" href="namespaceproton.html#ab9c78f87eaea1209fc1fb5c411081e6c">proton::amqp_int</a>(1) &lt;&lt; <a class="code" href="namespaceproton.html#ab9c78f87eaea1209fc1fb5c411081e6c">proton::amqp_int</a>(2) &lt;&lt; <a class="code" href="namespaceproton.html#ab9c78f87eaea1209fc1fb5c411081e6c">proton::amqp_int</a>(3) &lt;&lt; <a name="_a16"></a><a class="code" href="structproton_1_1finish.html">proton::finish</a>();</div>
<div class="line">    print(dv);</div>
<div class="line"></div>
<div class="line">    dv.<a name="a17"></a><a class="code" href="classproton_1_1value.html#abfa5d38453563c21f27bcdaf5898aac6">clear</a>();</div>
<div class="line">    dv.<a class="code" href="classproton_1_1value.html#a4add8b347e6b044857f2cffe9b0a9165">encoder</a>() &lt;&lt; <a name="a18"></a><a class="code" href="structproton_1_1start.html#a00185b222dcf8ad31edc8627428d32de">proton::start::list</a>() &lt;&lt; <a class="code" href="namespaceproton.html#ab9c78f87eaea1209fc1fb5c411081e6c">proton::amqp_int</a>(42) &lt;&lt; <span class="keyword">false</span> &lt;&lt; <a class="code" href="structproton_1_1amqp__symbol.html">proton::amqp_symbol</a>(<span class="stringliteral">&quot;x&quot;</span>) &lt;&lt; <a class="code" href="structproton_1_1finish.html">proton::finish</a>();</div>
<div class="line">    print(dv);</div>
<div class="line"></div>
<div class="line">    dv.<a class="code" href="classproton_1_1value.html#abfa5d38453563c21f27bcdaf5898aac6">clear</a>();</div>
<div class="line">    dv.<a class="code" href="classproton_1_1value.html#a4add8b347e6b044857f2cffe9b0a9165">encoder</a>() &lt;&lt; <a name="a19"></a><a class="code" href="structproton_1_1start.html#aae2ef381ba0bfc4307762b41598710fb">proton::start::map</a>() &lt;&lt; <span class="stringliteral">&quot;k1&quot;</span> &lt;&lt; <a class="code" href="namespaceproton.html#ab9c78f87eaea1209fc1fb5c411081e6c">proton::amqp_int</a>(42) &lt;&lt; <a class="code" href="structproton_1_1amqp__symbol.html">proton::amqp_symbol</a>(<span class="stringliteral">&quot;k2&quot;</span>) &lt;&lt; <span class="keyword">false</span> &lt;&lt; <a class="code" href="structproton_1_1finish.html">proton::finish</a>();</div>
<div class="line">    print(dv);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span>, <span class="keywordtype">char</span>**) {</div>
<div class="line">    <span class="keywordflow">try</span> {</div>
<div class="line">        simple_insert_extract();</div>
<div class="line">        simple_insert_extract_exact_type();</div>
<div class="line">        insert_extract_containers();</div>
<div class="line">        mixed_containers();</div>
<div class="line">        insert_extract_stream_operators();</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    } <span class="keywordflow">catch</span> (<span class="keyword">const</span> exception&amp; e) {</div>
<div class="line">        cerr &lt;&lt; endl &lt;&lt; <span class="stringliteral">&quot;error: &quot;</span> &lt;&lt; e.what() &lt;&lt; endl;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> 1;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// print_next prints the next value from values by recursively descending into complex values.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// NOTE this is for example puroses only: There is a built in ostream operator&lt;&lt; for values.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="keywordtype">void</span> print_next(<a class="code" href="classproton_1_1data.html">proton::data</a>&amp; dv) {</div>
<div class="line">    <a class="code" href="namespaceproton.html#a4b010ef0671b257e9ef88d3c903572bc">proton::type_id</a> type = dv.<a name="a20"></a><a class="code" href="classproton_1_1data.html#a251384855e416924fbf1bf80e48354e2">type</a>();</div>
<div class="line">    <a name="_a21"></a><a class="code" href="structproton_1_1start.html">proton::start</a> s;</div>
<div class="line">    <span class="keywordflow">switch</span> (type) {</div>
<div class="line">      <span class="keywordflow">case</span> <a name="a22"></a><a class="code" href="namespaceproton.html#a4b010ef0671b257e9ef88d3c903572bca7757a2968516d0793e2871a873dd3b9f">proton::ARRAY</a>: {</div>
<div class="line">          dv.<a name="a23"></a><a class="code" href="classproton_1_1data.html#a6c472d463ec10415011103df0435dbcc">decoder</a>() &gt;&gt; s;</div>
<div class="line">          cout &lt;&lt; <span class="stringliteral">&quot;array&lt;&quot;</span> &lt;&lt; s.<a name="a24"></a><a class="code" href="structproton_1_1start.html#a26fc6b2359af24d67f90251fc9899ead">element</a>;</div>
<div class="line">          <span class="keywordflow">if</span> (s.<a name="a25"></a><a class="code" href="structproton_1_1start.html#a4514a729fe3e745f95e7b4bc224b044a">is_described</a>) {</div>
<div class="line">              cout  &lt;&lt; <span class="stringliteral">&quot;, descriptor=&quot;</span>;</div>
<div class="line">              print_next(dv);</div>
<div class="line">          }</div>
<div class="line">          cout &lt;&lt; <span class="stringliteral">&quot;&gt;[&quot;</span>;</div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; s.<a name="a26"></a><a class="code" href="structproton_1_1start.html#a1cad79823f201f5c535218274d92bda5">size</a>; ++i) {</div>
<div class="line">              <span class="keywordflow">if</span> (i) cout &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>;</div>
<div class="line">              print_next(dv);</div>
<div class="line">          }</div>
<div class="line">          cout &lt;&lt; <span class="stringliteral">&quot;]&quot;</span>;</div>
<div class="line">          dv.<a class="code" href="classproton_1_1data.html#a6c472d463ec10415011103df0435dbcc">decoder</a>() &gt;&gt; <a class="code" href="structproton_1_1finish.html">proton::finish</a>();</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">case</span> <a name="a27"></a><a class="code" href="namespaceproton.html#a4b010ef0671b257e9ef88d3c903572bca6df4442cca14c86f8d7e94c999cdb04d">proton::LIST</a>: {</div>
<div class="line">          dv.<a class="code" href="classproton_1_1data.html#a6c472d463ec10415011103df0435dbcc">decoder</a>() &gt;&gt; s;</div>
<div class="line">          cout &lt;&lt; <span class="stringliteral">&quot;list[&quot;</span>;</div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; s.<a class="code" href="structproton_1_1start.html#a1cad79823f201f5c535218274d92bda5">size</a>; ++i) {</div>
<div class="line">              <span class="keywordflow">if</span> (i) cout &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>;</div>
<div class="line">              print_next(dv);</div>
<div class="line">          }</div>
<div class="line">          cout &lt;&lt; <span class="stringliteral">&quot;]&quot;</span>;</div>
<div class="line">          dv.<a class="code" href="classproton_1_1data.html#a6c472d463ec10415011103df0435dbcc">decoder</a>() &gt;&gt; <a class="code" href="structproton_1_1finish.html">proton::finish</a>();</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">case</span> <a name="a28"></a><a class="code" href="namespaceproton.html#a4b010ef0671b257e9ef88d3c903572bcafcf7d76b5fbc6a0d8a24a10a0fa7526e">proton::MAP</a>: {</div>
<div class="line">          dv.<a class="code" href="classproton_1_1data.html#a6c472d463ec10415011103df0435dbcc">decoder</a>() &gt;&gt; s;</div>
<div class="line">          cout &lt;&lt; <span class="stringliteral">&quot;map{&quot;</span>;</div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; s.<a class="code" href="structproton_1_1start.html#a1cad79823f201f5c535218274d92bda5">size</a>/2; ++i) {</div>
<div class="line">              <span class="keywordflow">if</span> (i) cout &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>;</div>
<div class="line">              print_next(dv);</div>
<div class="line">              cout &lt;&lt; <span class="stringliteral">&quot;:&quot;</span>;        <span class="comment">// key:value</span></div>
<div class="line">              print_next(dv);</div>
<div class="line">          }</div>
<div class="line">          cout &lt;&lt; <span class="stringliteral">&quot;}&quot;</span>;</div>
<div class="line">          dv.<a class="code" href="classproton_1_1data.html#a6c472d463ec10415011103df0435dbcc">decoder</a>() &gt;&gt; <a class="code" href="structproton_1_1finish.html">proton::finish</a>();</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">case</span> <a name="a29"></a><a class="code" href="namespaceproton.html#a4b010ef0671b257e9ef88d3c903572bca6be0f1a4758aad415c8024faeaf4bbd6">proton::DESCRIBED</a>: {</div>
<div class="line">          dv.<a class="code" href="classproton_1_1data.html#a6c472d463ec10415011103df0435dbcc">decoder</a>() &gt;&gt; s;</div>
<div class="line">          cout &lt;&lt; <span class="stringliteral">&quot;described(&quot;</span>;</div>
<div class="line">          print_next(dv);      <span class="comment">// Descriptor</span></div>
<div class="line">          print_next(dv);      <span class="comment">// value</span></div>
<div class="line">          dv.<a class="code" href="classproton_1_1data.html#a6c472d463ec10415011103df0435dbcc">decoder</a>() &gt;&gt; <a class="code" href="structproton_1_1finish.html">proton::finish</a>();</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">default</span>:</div>
<div class="line">        <span class="comment">// A simple type. We could continue the switch for all AMQP types but</span></div>
<div class="line">        <span class="comment">// instead we us the `value` type which can hold and print any AMQP</span></div>
<div class="line">        <span class="comment">// value.</span></div>
<div class="line">        <a class="code" href="classproton_1_1value.html">proton::value</a> v;</div>
<div class="line">        dv.<a class="code" href="classproton_1_1data.html#a6c472d463ec10415011103df0435dbcc">decoder</a>() &gt;&gt; v;</div>
<div class="line">        cout &lt;&lt; type &lt;&lt; <span class="stringliteral">&quot;(&quot;</span> &lt;&lt; v &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Print all the values with print_next</span></div>
<div class="line"><span class="keywordtype">void</span> print(<a class="code" href="classproton_1_1data.html">proton::data</a>&amp; dv) {</div>
<div class="line">    dv.<a class="code" href="classproton_1_1data.html#a6c472d463ec10415011103df0435dbcc">decoder</a>().<a class="code" href="classproton_1_1decoder.html#ae8566d9b29e7bdad7d327c6993a02c1c">rewind</a>();</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;Values: &quot;</span>;</div>
<div class="line">    <span class="keywordflow">while</span> (dv.<a class="code" href="classproton_1_1data.html#a6c472d463ec10415011103df0435dbcc">decoder</a>().<a name="a30"></a><a class="code" href="classproton_1_1decoder.html#a1d8d774114feb1364e41bde41e99f98f">more</a>()) {</div>
<div class="line">        print_next(dv);</div>
<div class="line">        <span class="keywordflow">if</span> (dv.<a class="code" href="classproton_1_1data.html#a6c472d463ec10415011103df0435dbcc">decoder</a>().<a class="code" href="classproton_1_1decoder.html#a1d8d774114feb1364e41bde41e99f98f">more</a>()) cout &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>;</div>
<div class="line">    }</div>
<div class="line">    cout &lt;&lt; endl;</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
